<?php

use GillesPinchart\Ai\api\ollama\mistral_api;
use GillesPinchart\Ai\APP\console\console;
use GillesPinchart\Ai\APP\server\server;
use GillesPinchart\Ai\APP\web\routes\routes;

require_once(__DIR__ . '/base_app.php');
define('AI_START', microtime(true));

// INIT
$env     = "" ;
$console = new console($argv);

// RUN COMMAND
switch ($console->action()){

/** COMMANDES **/
    case 'cmd':
        try {
            $console->command(function () use($console){
                match ($console->param()){
                    'test'   => dd("TEST"),
                    default  => dd("Codes ici ... ou dans le match")
                };
            });
        } catch (Exception $e) {
            dd($e);
        }
        break;

/** APIS **/
    case 'api':
        match ($console->param()){
            'mistral' =>(new mistral_api())->run($console->param(2)),
             default  =>dd("API innexistante.")
        };
        break;

/** SERVEUR WEB**/
    case 'serve':
        // Instance du serveur web
        $base_dir = __DIR__;
        $server  = new server($base_dir);
        $server->web_server($base_dir, 'AI');
        break;

    default :
        // Routing du serveur web
        define('AI_INDEX_START', microtime(true));
        (new routes())->display_routes();
        // Résumé :
        // 1) On lance le serveur web : php AI serve
        // 2) Ca va envoyer les requêtes de rooting ici (dès qu'on change d'url ça passe par ici)
        // 3) Le module de rooting identifie la route choisie et redirige le contenu html / css / js ou l'error 404
        // 4) Le site web peut faire des requêtes api en post vers le module de rooting
        //
        //
        //
        //
        break;


}